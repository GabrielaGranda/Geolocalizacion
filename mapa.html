<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ubicación del Conductor</title>
    <style>
        #map { width: 100%; height: 90vh; }
    </style>

    <!-- Mapas gratis con Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>

<h2>Ubicación en tiempo real</h2>
<div id="map"></div>

<script>
    const id = new URLSearchParams(window.location.search).get("id");

    // Inicializar mapa
    const map = L.map('map').setView([0, 0], 2);
    L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
    
    let marker = null;

    async function loadPosition() {
        const res = await fetch("https://geolocalizacion-iptg.onrender.com/get_location/" + id);
        const data = await res.json();

        if (!data.lat || !data.lng) return;

        if (!marker) {
            marker = L.marker([data.lat, data.lng]).addTo(map);
            map.setView([data.lat, data.lng], 15);
        } else {
            marker.setLatLng([data.lat, data.lng]);
        }
    }

    setInterval(loadPosition, 3000); // actualiza cada 3 segundos
</script>

</body>

</html>
